# mkjson.yaml

name: dbacks-json-mkjson

on: 
  workflow_dispatch:
jobs:
  make:
    runs-on: ubuntu-latest

    permissions:
      contents: read

    steps:
        - name: checkout
          uses: actions/checkout@v3        

        - name: make json file               
          run: |
            rm -rf outputs
            mkdir -p outputs
            node mkjson.js > outputs/dbacks.json

        - name: setup git config
          run: |
            pwd
            git config user.name "GitHub Actions Bot"
            git config user.email "<>"
            
        - name: commit
          run: |
            pwd

            git pull
            git add .
            
            newstuff=$( git status | grep "Changes to be committed" | sed 's/ //g' )
            echo $newstuff
            
            echo ${#newstuff}
            
            if (( ${#newstuff} > 0 )); then
              git commit -m "generated by a motet workflow"
              git push origin main              
            fi
